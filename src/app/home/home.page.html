
<ion-content [fullscreen]="true">
    <ion-toolbar color="primary">
    <ion-title>
      Pok√©dex
    </ion-title>
  </ion-toolbar>
  <ion-toolbar color="primary" class="toolbar-spacing">
    <ion-searchbar 
      [(ngModel)]="searchTerm"
      (ionInput)="onSearchChange($event)"
      (ionClear)="clearSearchAndReload()"
      (keyup.enter)="searchPokemon()"
      placeholder="Buscar por nombre o ID">
    </ion-searchbar>
    <ion-buttons slot="end">
      <ion-button (click)="searchPokemon()" [disabled]="!searchTerm.trim()">
        Buscar üîç
      </ion-button>
    </ion-buttons>
  </ion-toolbar>

  <!-- Indicador de carga para la b√∫squeda -->
  <div *ngIf="loading && searchTerm && !searchedPokemon && !searchError" class="ion-text-center ion-padding">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Buscando {{ searchTerm }}...</p>
  </div>

  <!-- Mensaje de error en la b√∫squeda -->
  <div *ngIf="searchError" class="ion-padding ion-text-center" style="color: var(--ion-color-danger);">
    <p style="font-size: 2em;">üò•</p>
    <p>{{ searchError }}</p>
    <ion-button (click)="clearSearchAndReload()" fill="outline">Limpiar b√∫squeda</ion-button>
  </div>

  <!-- Resultado de la B√∫squeda -->
  <ion-card *ngIf="searchedPokemon" class="ion-no-margin">
    <ion-img
      *ngIf="getImageUrl(searchedPokemon) !== 'assets/icon/favicon.png'"
      [src]="getImageUrl(searchedPokemon)"
      alt="{{ searchedPokemon.name }}"
      style="height: 200px; object-fit: contain; margin-top: 10px; display: block; margin-left: auto; margin-right: auto;"
    ></ion-img>
    <div *ngIf="getImageUrl(searchedPokemon) === 'assets/icon/favicon.png'" class="ion-text-center ion-padding">
        <p>üñºÔ∏è Imagen no disponible</p>
    </div>

    <ion-card-header class="ion-text-center">
      <ion-card-title class="ion-text-capitalize">
        {{ searchedPokemon.name || 'Nombre no disponible' }}
      </ion-card-title>
      <ion-card-subtitle>
        #{{ searchedPokemon.id || 'ID no disponible' }}
      </ion-card-subtitle>
    </ion-card-header>

    <ion-card-content class="ion-text-center">
      <div *ngIf="searchedPokemon.height !== undefined && searchedPokemon.height !== null">
          <p>Altura: {{ searchedPokemon.height / 10 }} m</p>
      </div>
      <div *ngIf="searchedPokemon.weight !== undefined && searchedPokemon.weight !== null">
          <p>Peso: {{ searchedPokemon.weight / 10 }} kg</p>
      </div>
      <div *ngIf="(searchedPokemon.height === undefined || searchedPokemon.height === null) && (searchedPokemon.weight === undefined || searchedPokemon.weight === null)" class="ion-padding">
          <p>Detalles de altura y peso no disponibles.</p>
      </div>

      <ion-button
        expand="block"
        (click)="goToPokemonDetail(searchedPokemon.name)"
        color="secondary"
        class="ion-margin-top"
        [disabled]="!searchedPokemon.name"
      >
        ‚ÑπÔ∏è Ver Detalles
      </ion-button>
    </ion-card-content>
  </ion-card>

  <!-- Lista de Pok√©mon (se muestra si no hay b√∫squeda activa o resultado) -->
  <div *ngIf="!searchTerm && !searchedPokemon && !searchError">
    <div *ngIf="loading && !pokemons.length" class="ion-text-center ion-padding">
        <ion-spinner name="dots"></ion-spinner>
        <p>Cargando Pok√©mon...</p>
    </div>
    <ion-list *ngIf="pokemons.length > 0">
      <ion-item *ngFor="let pokemon of pokemons" [button]="true" (click)="goToPokemonDetail(pokemon.name)">
        <ion-avatar slot="start">
          <ion-img [src]="getImageUrl(pokemon)" alt="{{pokemon.name}}"></ion-img>
        </ion-avatar>
        <ion-label class="ion-text-capitalize">
          {{ pokemon.name }}
        </ion-label>
      </ion-item>
    </ion-list>

    <ion-infinite-scroll (ionInfinite)="loadPokemons($event)" [disabled]="searchedPokemon || searchError || !pokemons.length">
      <ion-infinite-scroll-content
        loadingSpinner="bubbles"
        loadingText="Cargando m√°s Pok√©mon...">
      </ion-infinite-scroll-content>
    </ion-infinite-scroll>
  </div>

  <div *ngIf="!pokemons.length && !loading && !searchedPokemon && !searchError && !searchTerm" class="ion-text-center ion-padding">
    <p>No hay Pok√©mon para mostrar. Intenta cargar la lista o realizar una b√∫squeda.</p>
  </div>

</ion-content>